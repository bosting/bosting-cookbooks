# Generated by Chef, do not edit

User.create!(email: '<%= node['bosting-cp']['cp_login'] %>', password: '<%= node['bosting-cp']['cp_password'] %>', is_admin: true) if User.count == 0

[
    ['default_ns1', '<%= node['bosting-cp']['ns1_domain'] %>', :string, 'Первый NS сервер по умолчанию'],
    ['default_ns2', '<%= node['bosting-cp']['ns2_domain'] %>', :string, 'Второй NS сервер по умолчанию'],
    ['default_mx', '<%= node['bosting-cp']['default_mx'] %>', :string, 'MX сервер по умолчанию'],
    ['mysql_socket', '/tmp/mysql.sock', :string, 'UNIX сокет MySQL'],
    ['directory_index', 'index.php index.phtml index.shtml index.html index.htm', :string, 'Индексные файлы по умолчанию'],
    ['dir_mode', '00750', :string, 'Маска папок']
].each do |name, value, value_type, description|
  Setting.find_or_create_by!(name: name, value_type: Setting::TYPES[value_type]) do |s|
    s.value = value
    s.description = description
  end
end

<%- if node['platform'] == 'freebsd' -%>
<%= node['bosting-cp']['apache_variations'] %>.each do |name, attrs|
  ApacheVariation.find_or_create_by!(name: name, ip: attrs['ip']) do |av|
    av.description = "Apache #{attrs['apache_version']}, PHP #{attrs['php_version']}"
    av.apache_version = attrs['apache_version']
    av.php_version = attrs['php_version']
  end
end
<%- end -%>

[
    ['<%= node['bosting-cp']['ip'] %>', '<%= node['bosting-cp']['fqdn'] %>', true],
    ['<%= node['bosting-cp']['ns1_ip'] %>', '<%= node['bosting-cp']['ns1_domain'] %>', false],
    ['<%= node['bosting-cp']['ns2_ip'] %>', '<%= node['bosting-cp']['ns2_domain'] %>', false]
].each do |ip_address, name, is_default|
  IpAddress.find_or_create_by!(ip: ip_address, name: name) do |ip_address|
    ip_address.is_default = is_default
  end
end

[%w(webuser 1000), %w(nogroup 65533)].each do |name, gid|
  SystemGroup.find_or_create_by!(name: name, gid: gid)
end

[
    ['bash', '/usr/local/bin/bash', true],
    ['csh', '/bin/csh', false],
    ['tcsh', '/bin/tcsh', false],
    ['zsh', '/usr/local/bin/zsh', false],
    ['nologin', '/usr/sbin/nologin', false]
].each do |name, path, is_default|
  SystemUserShell.find_or_create_by!(name: name) do |sus|
    sus.path = path
    sus.is_default = is_default
  end
end

%w(NS A AAAA CNAME MX SRV TXT SPF).each do |name|
  DnsRecordType.find_or_create_by!(name: name)
end
