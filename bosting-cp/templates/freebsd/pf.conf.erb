# Generated by Chef, do not edit

ext_if="<%= node['bosting-cp']['ext_if'] %>"
int_if="<%= node['bosting-cp']['int_if'] %>"

services_ips="{ <%= node['bosting-cp']['services_ips'].join(' ') %> }"
ssh_listen_ips="{ <%= node['bosting-cp']['ssh_listen_ips'].join(' ') %> }"
ssh_listen_port="<%= node['bosting-cp']['ssh_port_listen'] %>"

tcp_services="{ ssh domain http https ftp ftp-data pop3 smtp imap 49000:50000 <%= node['bosting-cp']['open_tcp_ports'] %> }"
udp_services="{ domain ntp <%= node['bosting-cp']['open_udp_ports'] %> }"
icmp_types="{ echoreq unreach }"

set skip on { lo0 lo1 $int_if }

scrub in all

nat on $ext_if from lo1:network to any -> ($ext_if)

table <ddos> persist
block quick on $ext_if from { <ddos> }

block in
pass out

antispoof quick for { lo0 lo1 $ext_if $int_if }

pass in proto tcp to $ssh_listen_ips port $ssh_listen_port
pass in proto tcp from $services_ips to $ext_if port $tcp_services
pass in proto udp from $services_ips to $ext_if port $udp_services

pass in on $ext_if inet proto icmp all icmp-type $icmp_types
